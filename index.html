<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Photography Portfolio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        .hero {
            height: 100vh;
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('your-background-image.jpg');
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
        }

        .hero-content h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
        }

        .gallery {
            padding: 50px 10%;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .gallery img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 10px;
            transition: transform 0.3s;
        }

            /* Make gallery images clickable and add a lightbox overlay */
            .gallery img { cursor: pointer; }

            .lightbox-overlay {
                position: fixed;
                inset: 0;
                background: rgba(0,0,0,0.9);
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                padding: 20px;
            }

            .lightbox-overlay.active { display: flex; }

            .lightbox-content {
                max-width: 95vw;
                max-height: 95vh;
                display: flex;
                align-items: center;
                justify-content: center;
                position: relative;
            }

            .lightbox-img {
                max-width: 100%;
                max-height: 100%;
                border-radius: 8px;
                box-shadow: 0 12px 40px rgba(0,0,0,0.6);
            }

            .lightbox-close, .lightbox-prev, .lightbox-next {
                position: absolute;
                background: rgba(0,0,0,0.5);
                color: #fff;
                border: none;
                padding: 10px 12px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 18px;
            }

            .lightbox-close { top: 12px; right: 12px; }
            .lightbox-prev { left: 12px; top: 50%; transform: translateY(-50%); }
            .lightbox-next { right: 12px; top: 50%; transform: translateY(-50%); }

        .gallery img:hover {
            transform: scale(1.05);
        }

        nav {
            position: fixed;
            width: 100%;
            padding: 20px;
            background: rgba(0,0,0,0.8);
            z-index: 10;
        }

        nav a {
            color: white;
            text-decoration: none;
            margin: 0 20px;
        }

        /* Chat widget styles */
        .chat-widget {
            position: fixed;
            right: 20px;
            bottom: 20px;
            z-index: 1000;
            font-family: inherit;
        }

        .chat-toggle {
            background: #0066ff;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 999px;
            cursor: pointer;
            box-shadow: 0 6px 18px rgba(0,0,0,0.2);
        }

        .chat-panel {
            width: 340px;
            max-width: calc(100vw - 40px);
            height: 480px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Ensure the chat panel shows/hides reliably with a class on the widget */
        .chat-widget .chat-panel { display: none; }
        .chat-widget.open .chat-panel { display: flex; }
        .chat-widget .chat-toggle { display: inline-block; }
        .chat-widget.open .chat-toggle { background: #ff3333; }

        .chat-header {
            background: #0f172a;
            color: white;
            padding: 12px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }

        .chat-messages {
            padding: 12px;
            flex: 1 1 auto;
            overflow-y: auto;
            background: linear-gradient(180deg,#f7f7fb,#fff);
        }

        .chat-message {
            margin: 8px 0;
            padding: 10px 12px;
            border-radius: 10px;
            max-width: 85%;
            line-height: 1.3;
        }

        .chat-message.user {
            background: #e6f0ff;
            align-self: flex-end;
        }

        .chat-message.assistant {
            background: #f1f1f5;
            align-self: flex-start;
        }

        .chat-form {
            display: flex;
            gap: 8px;
            padding: 10px;
            border-top: 1px solid #eee;
            background: white;
        }

        .chat-form input[type="text"] {
            flex: 1 1 auto;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            outline: none;
        }

        .chat-form button[type="submit"] {
            background: #0066ff;
            color: white;
            border: none;
            padding: 10px 14px;
            border-radius: 8px;
            cursor: pointer;
        }

        @media (max-width: 480px) {
            .chat-panel { height: 60vh; width: 92vw; }
        }
        /* Casino theme: black & red accents */
        .casino { background: #0b0b0b; color: #f7f7f7; }
        .casino h2, .casino h3 { color: #ff3333; }
        .casino .casino-grid > div { background: #111; border: 1px solid #330000; color: #fff; }
        .casino .slot-reels { background: #060606; padding: 10px; border-radius: 8px; }
        .casino .slot-reels .reel { display:flex;align-items:center;justify-content:center;width:72px;height:72px;background:#111;border-radius:8px;font-size:40px; }
        .casino .slot-reels .reel.spinning { animation: reel-spin 0.18s linear infinite; transform-origin:center; }
        @keyframes reel-spin {
            0% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-6px) scale(1.05); }
            100% { transform: translateY(0) scale(1); }
        }
        .casino input[type="number"] { background:#111;color:#ff3333;border:1px solid #333 }
        /* Make credit & score numbers red for casino theme */
        .casino #slotCredits, .casino #bjCredits, .casino #playerScore, .casino #dealerScore, .casino #slotResult {
            color: #ff3333; font-weight:700;
        }
        /* Make bet inputs/text red */
        .casino #slotBet, .casino #bjBet { color: #ff3333; font-weight:700 }
        .casino button { background: #b30000; color: #ff3333; border: none; cursor: pointer; }
        .casino button[disabled] { opacity: 0.5; cursor: not-allowed }
        .casino .slot-result { color:#ffd700; font-weight:700 }
    </style>
</head>
<body>
    <nav>
        <a href="#home">Home</a>
        <a href="#gallery">Gallery</a>
        <a href="#casino">Casino</a>
        <a href="#contact">Contact</a>
    </nav>

    <section class="hero" id="home">
        <div class="hero-content">
            <h1>My Photography</h1>
            <p>Capturing moments that last forever</p>
        </div>
    </section>

    <!-- Casino section: Slot + Blackjack -->
    <section class="casino" id="casino" style="padding:50px 10%;">
        <h2 style="margin-bottom:16px;">Casino Corner</h2>
        <div class="casino-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:20px;align-items:start;">
            <!-- Slot Machine -->
            <div class="slot" style="background:#6e6e6e;padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.08);">
                <h3>Slot Machine</h3>
                <div class="slot-reels" style="display:flex;gap:8px;justify-content:center;margin:12px 0;font-size:40px;">
                    <div id="reel1" class="reel">üçí</div>
                    <div id="reel2" class="reel">üçã</div>
                    <div id="reel3" class="reel">üîî</div>
                </div>
                <div style="display:flex;gap:8px;align-items:center;justify-content:center;margin-bottom:12px;">
                    <button id="spinBtn" style="padding:8px 12px;border-radius:8px;background:#0066ff;color:#fff;border:none;cursor:pointer;">Spin</button>
                    <div id="slotResult" style="min-width:140px;text-align:center;font-weight:600;">Good luck!</div>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <div>Credits: <span id="slotCredits">100</span></div>
                    <div>Bet: <input id="slotBet" type="number" value="5" min="1" style="width:60px;padding:4px;border-radius:6px;border:1px solid #ddd;"/></div>
                </div>
            </div>

            <!-- Blackjack -->
            <div class="blackjack" style="background:#6e6e6e;padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.08);">
                <h3>Blackjack (Single-player)</h3>
                <div style="margin-bottom:8px;">Credits: <span id="bjCredits">100</span> | Bet: <input id="bjBet" type="number" value="10" min="1" style="width:80px;padding:4px;border-radius:6px;border:1px solid #ddd;"/></div>
                <div style="display:flex;gap:12px;">
                    <div style="flex:1">
                        <div style="font-weight:700">Dealer</div>
                        <div id="dealerCards" style="min-height:40px;margin:6px 0"></div>
                        <div id="dealerScore"></div>
                    </div>
                    <div style="flex:1">
                        <div style="font-weight:700">Player</div>
                        <div id="playerCards" style="min-height:40px;margin:6px 0"></div>
                        <div id="playerScore"></div>
                    </div>
                </div>
                <div style="margin-top:10px;display:flex;gap:8px;">
                    <button id="bjDeal" style="padding:8px;border-radius:8px;background:#06b; color:#fff;border:none;cursor:pointer;">Deal</button>
                    <button id="bjHit" style="padding:8px;border-radius:8px;background:#0a0;color:#fff;border:none;cursor:pointer;" disabled>Hit</button>
                    <button id="bjDouble" style="padding:8px;border-radius:8px;background:#c06;color:#fff;border:none;cursor:pointer;" disabled>Double</button>
                    <button id="bjSplit" style="padding:8px;border-radius:8px;background:#666;color:#fff;border:none;cursor:pointer;" disabled>Split</button>
                    <button id="bjStand" style="padding:8px;border-radius:8px;background:#a60;color:#fff;border:none;cursor:pointer;" disabled>Stand</button>
                    <div id="bjMessage" style="margin-left:8px;font-weight:600;align-self:center"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Lightbox overlay for gallery images -->
    <div class="lightbox-overlay" id="lightbox">
        <div class="lightbox-content">
            <button class="lightbox-close" id="lightboxClose">‚úï</button>
            <button class="lightbox-prev" id="lightboxPrev"></button>
            <img src="" alt="" class="lightbox-img" id="lightboxImg">
            <button class="lightbox-next" id="lightboxNext"></button>
        </div>
    </div>

    <section class="gallery" id="gallery">
        <!-- All images and gifs from the image/ folder -->
        <img src="image/chrome_2JW2bmt8o1.png" data-full="image/chrome_2JW2bmt8o1.png" alt="chrome_2JW2bmt8o1">
        <img src="image/chrome_5xlr35FH1u.png" data-full="image/chrome_5xlr35FH1u.png" alt="chrome_5xlr35FH1u">
        <img src="image/chrome_AxE09hx3zy.png" data-full="image/chrome_AxE09hx3zy.png" alt="chrome_AxE09hx3zy">
        <img src="image/chrome_NSWpwLrwDM.png" data-full="image/chrome_NSWpwLrwDM.png" alt="chrome_NSWpwLrwDM">
        <img src="image/chrome_qdu6343qHa.png" data-full="image/chrome_qdu6343qHa.png" alt="chrome_qdu6343qHa">
        <img src="image/chrome_uAJ9UvdhZS.png" data-full="image/chrome_uAJ9UvdhZS.png" alt="chrome_uAJ9UvdhZS">
        <img src="image/chrome_UsBaaADgte.png" data-full="image/chrome_UsBaaADgte.png" alt="chrome_UsBaaADgte">
        <img src="image/chrome_xWXdrcemlw.png" data-full="image/chrome_xWXdrcemlw.png" alt="chrome_xWXdrcemlw">
        <img src="image/chrome_ZSKXoBwBdL.png" data-full="image/chrome_ZSKXoBwBdL.png" alt="chrome_ZSKXoBwBdL">
        <img src="image/Discord_CVhzXzs6Pd.png" data-full="image/Discord_CVhzXzs6Pd.png" alt="Discord_CVhzXzs6Pd">
        <img src="image/Discord_Dw5YGGzyuM.png" data-full="image/Discord_Dw5YGGzyuM.png" alt="Discord_Dw5YGGzyuM">
        <img src="image/Discord_EgZJNDBG7g.png" data-full="image/Discord_EgZJNDBG7g.png" alt="Discord_EgZJNDBG7g">
        <img src="image/Discord_HFuWdR5HpL.png" data-full="image/Discord_HFuWdR5HpL.png" alt="Discord_HFuWdR5HpL">
        <img src="image/Discord_Lwyw03ugpA.png" data-full="image/Discord_Lwyw03ugpA.png" alt="Discord_Lwyw03ugpA">
        <img src="image/Discord_o8TXdd31h5.png" data-full="image/Discord_o8TXdd31h5.png" alt="Discord_o8TXdd31h5">
        <img src="image/Discord_RPtJLrAsvH.png" data-full="image/Discord_RPtJLrAsvH.png" alt="Discord_RPtJLrAsvH">
        <img src="image/Discord_W2GNKY46dO.png" data-full="image/Discord_W2GNKY46dO.png" alt="Discord_W2GNKY46dO">
        <img src="image/Mediasak_TSsPBMKeEc.jpg" data-full="image/Mediasak_TSsPBMKeEc.jpg" alt="Mediasak">
        <img src="image/opera_TSqOY7F61O.png" data-full="image/opera_TSqOY7F61O.png" alt="opera_TSqOY7F61O">
        <img src="image/YakuzaKiwami2_kYP1aEThJA.png" data-full="image/YakuzaKiwami2_kYP1aEThJA.png" alt="YakuzaKiwami2">
        <!-- GIFs -->
        <img src="image/gifs/attachment.gif" data-full="image/gifs/attachment.gif" alt="attachment">
        <img src="image/gifs/chrome_CWxMAk01Av.gif" data-full="image/gifs/chrome_CWxMAk01Av.gif" alt="chrome_anim">
        <img src="image/gifs/cmd_V7oWXBIpGJ.gif" data-full="image/gifs/cmd_V7oWXBIpGJ.gif" alt="cmd_anim">
        <img src="image/gifs/ezgif.com-gif-maker_4.gif" data-full="image/gifs/ezgif.com-gif-maker_4.gif" alt="ezgif">
        <img src="image/gifs/philip015.gif" data-full="image/gifs/philip015.gif" alt="philip015">
    </section>

    <!-- Chat widget -->
    <div class="chat-widget" id="chatWidget">
        <button class="chat-toggle" id="chatToggle" aria-label="Open chat">Chat</button>
        <div class="chat-panel" id="chatPanel" hidden>
            <div class="chat-header">
                <span>Chat with ChatGPT</span>
                <button id="chatClose" aria-label="Close" style="background:none;border:none;color:white;font-size:20px;cursor:pointer">√ó</button>
            </div>
            <div class="chat-messages" id="chatMessages" role="log" aria-live="polite"></div>
            <form id="chatForm" class="chat-form">
                <input id="chatInput" type="text" placeholder="Say hi to ChatGPT..." autocomplete="off" />
                <button type="submit">Send</button>
            </form>
        </div>
    </div>

    <script>
    (function(){
        const chatToggle = document.getElementById('chatToggle');
        const chatPanel = document.getElementById('chatPanel');
        const chatClose = document.getElementById('chatClose');
        const chatForm = document.getElementById('chatForm');
        const chatInput = document.getElementById('chatInput');
        const chatMessages = document.getElementById('chatMessages');

                function appendMessage(role, text) {
            const msg = document.createElement('div');
            msg.className = 'chat-message ' + role;
            msg.textContent = text;
            chatMessages.appendChild(msg);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return msg;
        }

                // Client-side mock responses (same idea as server-side mock)
                const mockResponses = [
                    "Hi! I love talking about photography ‚Äî what kind of photos do you like?",
                    "Natural light can make portraits feel more alive. Try shooting near a window.",
                    "Golden hour (shortly after sunrise or before sunset) is perfect for warm, soft light.",
                    "For crisp landscapes, use a small aperture like f/8 to f/16.",
                    "Try a low ISO and a tripod for long exposure shots at night.",
                    "I recommend shooting in RAW if you plan to edit heavily later.",
                    "Experiment with different angles ‚Äî sometimes the best shot is from the ground.",
                    "Rule of thirds is a great starting composition guideline, but break it when it helps.",
                    "Use a reflector to fill shadows when shooting faces outdoors.",
                    "If you want creamy background blur, use a wide aperture (small f-number).",
                    "For action shots, prioritize shutter speed over aperture to freeze motion.",
                    "Try backlighting to get a rim light effect ‚Äî expose for the subject, not the sky.",
                    "Use manual white balance when mixed lighting throws off your colors.",
                    "A polarizing filter helps reduce reflections and deepen skies.",
                    "Practice makes perfect ‚Äî shoot every day, even quick studies on your phone.",
                    "If you want to sell prints, consider offering square and landscape crops.",
                    "Storytelling matters: think about the emotion you want the image to convey.",
                    "Minimalist compositions often work well for galleries and social media.",
                    "Try a 50mm prime lens for versatile portraits with pleasing perspective.",
                    "Capture candid moments by blending into the scene and using a longer lens.",
                    "For product photos, use soft, even lighting and a clean background.",
                    "When editing, subtle adjustments usually read as more professional than heavy filters.",
                    "Consider tethered shooting for studio sessions ‚Äî it speeds feedback and selection.",
                    "Local contrast and clarity can bring out texture in landscape photos.",
                    "Bring spare batteries and memory cards on long shoots ‚Äî they always help.",
                    "Try shooting in burst mode for unpredictable movement and pick the best frame.",
                    "Use leading lines to guide the viewer's eye through your composition.",
                    "If you're starting out, focus on mastering exposure before advanced techniques.",
                    "Learn basic color theory ‚Äî complementary colors often create strong visuals.",
                    "When photographing people, chat with them ‚Äî relaxed subjects look better.",
                    "Macro photography reveals textures you wouldn't notice at first glance.",
                    "Try black & white conversions to emphasize shape and emotion.",
                    "For architecture, correct perspective distortion in post if needed.",
                    "Create a portfolio of 10‚Äì20 strong images rather than many average ones.",
                    "Offer limited edition prints to create exclusivity for collectors.",
                    "If you're unsure how to price work, research local photographers with similar style.",
                    "Use social media to share behind-the-scenes content; clients love that.",
                    "Back up your photos in at least two separate places (cloud + local).",
                    "Don't be afraid to crop tightly to remove distractions and focus the subject.",
                    "Try intentional camera movement for creative abstract effects.",
                    "If you want, I can help suggest camera settings for a specific scene ‚Äî tell me the camera and lighting.",
                    "Want a random photography tip or a set of editing presets? I can provide more."
                ];

                function chooseMockReply(message) {
                    if (!message) return mockResponses[0];
                    const m = message.toLowerCase();
                    const pricingKeywords = ['price', 'cost', 'rate', 'charge', 'pricing'];
                    const bookingKeywords = ['book', 'available', 'availability', 'schedule', 'date'];
                    const lightingKeywords = ['light', 'lighting', 'golden', 'sunset', 'sunrise', 'flash'];
                    const equipmentKeywords = ['lens', 'camera', 'tripod', 'filter', 'iso', 'aperture', 'shutter'];

                    if (pricingKeywords.some(k => m.includes(k))) {
                        const options = [
                            "Pricing varies by session length and usage ‚Äî tell me what you need and I can suggest a package.",
                            "I offer portrait sessions, event coverage, and print packages. Which are you interested in?",
                            "For most portraits, a basic session starts with a licence for personal use; commercial pricing is different."
                        ];
                        return options[Math.floor(Math.random() * options.length)];
                    }

                    if (bookingKeywords.some(k => m.includes(k))) {
                        const options = [
                            "I usually book 2‚Äì4 weeks in advance; let me know the date and I'll check availability.",
                            "Send me the preferred date and type of session (portrait, event, product) and I'll confirm availability.",
                            "I can hold a tentative slot for 48 hours if you need time to confirm."
                        ];
                        return options[Math.floor(Math.random() * options.length)];
                    }

                    if (lightingKeywords.some(k => m.includes(k))) {
                        const options = [
                            "Softer light is usually better for portraits ‚Äî try shooting in shade or during golden hour.",
                            "Use a diffuser for harsh midday sun or seek open shade for even light.",
                            "If you're indoors, position subjects facing a large window for flattering natural light."
                        ];
                        return options[Math.floor(Math.random() * options.length)];
                    }

                    if (equipmentKeywords.some(k => m.includes(k))) {
                        const options = [
                            "A 50mm prime is a great all-around lens for portraits and low-light shooting.",
                            "A sturdy tripod makes long exposures and landscapes much easier to nail.",
                            "If you want background blur, use a lens with a wide maximum aperture (f/1.8, f/1.4)."
                        ];
                        return options[Math.floor(Math.random() * options.length)];
                    }

                    return mockResponses[Math.floor(Math.random() * mockResponses.length)];
                }

        // Robust toggle: add/remove `open` class on the widget so CSS controls visibility
        const chatWidgetEl = document.getElementById('chatWidget');
        function openChat(){
            chatWidgetEl.classList.add('open');
            chatPanel.hidden = false;
            chatToggle.setAttribute('aria-expanded','true');
            chatToggle.setAttribute('aria-label','Close chat');
            chatInput.focus();
        }
        function closeChat(){
            chatWidgetEl.classList.remove('open');
            chatPanel.hidden = true;
            chatToggle.setAttribute('aria-expanded','false');
            chatToggle.setAttribute('aria-label','Open chat');
            chatToggle.focus();
        }

        chatToggle.addEventListener('click', () => {
            if (chatWidgetEl.classList.contains('open')) closeChat(); else openChat();
        });

        chatClose.addEventListener('click', () => { closeChat(); });

        chatForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const text = chatInput.value.trim();
            if (!text) return;
            appendMessage('user', text);
            chatInput.value = '';
            const thinking = appendMessage('assistant', 'Thinking...');

            try {
                const res = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text })
                });
                const data = await res.json().catch(() => null);

                if (res.ok && data) {
                    // Support both simple {reply: '...'} and OpenAI-like structures
                    if (data.reply) {
                        thinking.textContent = data.reply;
                    } else if (data.choices && data.choices[0] && data.choices[0].message) {
                        thinking.textContent = data.choices[0].message.content;
                    } else {
                        thinking.textContent = 'No reply from server.';
                    }
                } else {
                    thinking.textContent = 'Server returned an error.';
                    console.error('Chat error', res.status, data);
                    // Fallback to client-side mock reply
                    const fallback = chooseMockReply(text);
                    thinking.textContent = fallback + ' (mock)';
                }
            } catch (err) {
                console.error(err);
                // Network or server unreachable ‚Äî use client-side mock reply
                const fallback = chooseMockReply(text);
                thinking.textContent = fallback + ' (mock)';
            }
        });

        // Small UX: show a starter hint when opening first time
        chatToggle.addEventListener('dblclick', () => {
            if (chatPanel.hidden) {
                chatPanel.hidden = false;
                chatToggle.style.display = 'none';
                appendMessage('assistant', 'Tip: This demo expects a POST /api/chat endpoint. If not available you will see a fallback.');
            }
        });

        // ----------------- Lightbox for gallery images -----------------
        (function(){
            const galleryImgs = Array.from(document.querySelectorAll('.gallery img'));
            const overlay = document.getElementById('lightbox');
            const overlayImg = document.getElementById('lightboxImg');
            const closeBtn = document.getElementById('lightboxClose');
            const prevBtn = document.getElementById('lightboxPrev');
            const nextBtn = document.getElementById('lightboxNext');
            let current = 0;

            function openAt(index){
                current = (index + galleryImgs.length) % galleryImgs.length;
                const img = galleryImgs[current];
                const src = img.dataset.full || img.src;
                overlayImg.src = src;
                overlay.classList.add('active');
            }

            function close(){ overlay.classList.remove('active'); overlayImg.src = ''; }

            galleryImgs.forEach((img, idx)=>{
                img.style.cursor = 'pointer';
                img.addEventListener('click', ()=> openAt(idx));
            });

            closeBtn.addEventListener('click', close);
            overlay.addEventListener('click', (e)=>{ if (e.target===overlay) close(); });
            prevBtn.addEventListener('click', ()=> openAt(current-1));
            nextBtn.addEventListener('click', ()=> openAt(current+1));

            document.addEventListener('keydown', (e)=>{
                if (!overlay.classList.contains('active')) return;
                if (e.key === 'Escape') close();
                if (e.key === 'ArrowLeft') openAt(current-1);
                if (e.key === 'ArrowRight') openAt(current+1);
            });
        })();

        // ----------------- Casino games logic -----------------
        // Slot machine
        (function(){
            const symbols = ['üçí','üçã','üîî','‚≠ê','7Ô∏è‚É£','üíé'];
            const reel1 = document.getElementById('reel1');
            const reel2 = document.getElementById('reel2');
            const reel3 = document.getElementById('reel3');
            const spinBtn = document.getElementById('spinBtn');
            const slotResult = document.getElementById('slotResult');
            const slotCredits = document.getElementById('slotCredits');
            const slotBet = document.getElementById('slotBet');

            // Small WebAudio helpers for sounds (graceful if not supported)
            let audioCtx = null;
            function ensureAudio(){
                if (audioCtx) return true;
                try { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); return true; } catch(e){ return false; }
            }

            function playTone(freq=440, duration=0.08, type='sine', vol=0.08){
                if (!ensureAudio()) return;
                const o = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                o.type = type; o.frequency.value = freq;
                g.gain.value = vol;
                o.connect(g); g.connect(audioCtx.destination);
                o.start();
                setTimeout(()=>{ o.stop(); g.disconnect(); o.disconnect(); }, duration*1000);
            }

            function playTick(){ playTone(900, 0.04, 'square', 0.06); }
            function playStart(){ playTone(240, 0.06, 'sine', 0.06); }
            function playLose(){ playTone(160, 0.12, 'triangle', 0.06); }
            function playWin(){
                if (!ensureAudio()) return;
                // simple jingle
                const seq = [880, 660, 990];
                seq.forEach((f,i)=> setTimeout(()=> playTone(f, 0.12, 'sine', 0.08), i*150));
            }

            function randSymbol(){ return symbols[Math.floor(Math.random()*symbols.length)]; }

            function updateCredits(delta){
                slotCredits.textContent = Math.max(0, parseInt(slotCredits.textContent || '0') + delta);
            }

            let spinning = false;
            spinBtn.addEventListener('click', () => {
                if (spinning) return;
                const bet = Math.max(1, Math.floor(Number(slotBet.value) || 1));
                if (parseInt(slotCredits.textContent) < bet) {
                    slotResult.textContent = 'Not enough credits';
                    return;
                }
                updateCredits(-bet);
                spinning = true;
                slotResult.textContent = 'Spinning...';
                playStart();
                const intervals = [50,60,70,90,120,180,260];
                const final = [randSymbol(), randSymbol(), randSymbol()];
                let i = 0;
                const ints = symbols.map(() => null);
                // animate each reel with staggered stop
                function spinReel(reel, idx, stopAfter){
                    // add visual spinning class
                    try{ reel.classList.add('spinning'); } catch(e){}
                    let ticks = 0;
                    ints[idx] = setInterval(()=>{
                        reel.textContent = randSymbol();
                        ticks++;
                        if (ticks > stopAfter){
                            clearInterval(ints[idx]);
                            // mark this reel as stopped so we can detect when all reels stopped
                            ints[idx] = null;
                            // stop visual spinning and set final symbol
                            try{ reel.classList.remove('spinning'); } catch(e){}
                            reel.textContent = final[idx];
                            playTick();
                            // when all stopped, evaluate
                            if (ints.every(v=>v===null)) {
                                evaluate(final, bet);
                                spinning = false;
                            }
                        }
                    }, 60 + idx*30);
                }

                spinReel(reel1,0,10 + Math.floor(Math.random()*6));
                spinReel(reel2,1,14 + Math.floor(Math.random()*8));
                spinReel(reel3,2,18 + Math.floor(Math.random()*10));
            });

            function evaluate(final, bet){
                const [a,b,c] = final;
                if (a===b && b===c){
                    // three of a kind
                    const win = bet * 10;
                    updateCredits(win);
                    slotResult.textContent = `JACKPOT! +${win}`;
                    try{ playWin(); } catch(e){}
                } else if (a===b || b===c || a===c){
                    const win = bet * 2;
                    updateCredits(win);
                    slotResult.textContent = `Nice! +${win}`;
                    try{ playWin(); } catch(e){}
                } else {
                    slotResult.textContent = 'No luck ‚Äî try again!';
                    try{ playLose(); } catch(e){}
                }
            }
        })();

        // Blackjack (with double and split support)
        (function(){
            const bjCredits = document.getElementById('bjCredits');
            const bjBet = document.getElementById('bjBet');
            const dealerCards = document.getElementById('dealerCards');
            const playerCards = document.getElementById('playerCards');
            const dealerScore = document.getElementById('dealerScore');
            const playerScore = document.getElementById('playerScore');
            const bjDeal = document.getElementById('bjDeal');
            const bjHit = document.getElementById('bjHit');
            const bjDouble = document.getElementById('bjDouble');
            const bjSplit = document.getElementById('bjSplit');
            const bjStand = document.getElementById('bjStand');
            const bjMessage = document.getElementById('bjMessage');

            function createDeck(){
                const suits = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
                const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
                const deck = [];
                suits.forEach(s=>ranks.forEach(r=>deck.push(r+s)));
                return deck;
            }

            function shuffle(a){
                for(let i=a.length-1;i>0;i--){
                    const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];
                }
            }

            function cardValue(card){
                const r = card.slice(0, -1);
                if (r==='A') return 11;
                if (['K','Q','J'].includes(r)) return 10;
                return Number(r);
            }

            function scoreHand(hand){
                let sum=0;let aces=0;
                hand.forEach(c=>{const v=cardValue(c);sum+=v;if (c.startsWith('A')) aces++;});
                while(sum>21 && aces>0){sum-=10;aces--;}
                return sum;
            }

            let deck=[], dealerHand=[], playerHands=[], betsPerHand=[], currentHand=0, inRound=false;

            function resetDisplay(){
                dealerCards.textContent='';playerCards.textContent='';dealerScore.textContent='';playerScore.textContent='';bjMessage.textContent='';
            }

            function renderHands(hideDealerSecond){
                dealerCards.textContent='';dealerHand.forEach((c,i)=>{
                    const span=document.createElement('span');span.textContent = (i===1 && hideDealerSecond)?'üÇ†':c;span.style.marginRight='6px';dealerCards.appendChild(span);
                });
                playerCards.textContent='';
                playerHands.forEach((hand, idx)=>{
                    const wrapper = document.createElement('div');
                    wrapper.style.marginBottom='6px';
                    wrapper.style.padding = (idx===currentHand && inRound) ? '6px' : '4px';
                    wrapper.style.border = (idx===currentHand && inRound) ? '2px solid #06b' : '1px dashed #ccc';
                    wrapper.style.display = 'inline-block';
                    wrapper.style.marginRight = '8px';
                    hand.forEach(c=>{const span=document.createElement('span');span.textContent=c;span.style.marginRight='6px';wrapper.appendChild(span);});
                    const sc = scoreHand(hand);
                    const scoreSpan = document.createElement('div');scoreSpan.style.fontSize='12px';scoreSpan.textContent = `Score: ${sc}`;wrapper.appendChild(scoreSpan);
                    playerCards.appendChild(wrapper);
                });
                // summary scores
                playerScore.textContent = playerHands.map((h,i)=>`Hand ${i+1}: ${scoreHand(h)}`).join(' | ');
                if (!hideDealerSecond) dealerScore.textContent = `Score: ${scoreHand(dealerHand)}`; else dealerScore.textContent = '';
            }

            function endRound(msg, payouts){
                // payouts: array matching betsPerHand with amount to add to credits
                inRound=false;bjHit.disabled=true;bjStand.disabled=true;bjDouble.disabled=true;bjSplit.disabled=true;bjDeal.disabled=false;
                if (Array.isArray(payouts)){
                    payouts.forEach(p=>{ if(p) bjCredits.textContent = Math.max(0, parseInt(bjCredits.textContent||'0') + p); });
                } else if (payouts) {
                    bjCredits.textContent = Math.max(0, parseInt(bjCredits.textContent||'0') + payouts);
                }
                bjMessage.textContent = msg;
            }

            function canSplit(hand){
                if (!hand || hand.length!==2) return false;
                const r1 = hand[0].slice(0,-1); const r2 = hand[1].slice(0,-1);
                return r1===r2;
            }

            bjDeal.addEventListener('click', ()=>{
                const bet = Math.max(1, Math.floor(Number(bjBet.value)||1));
                if (parseInt(bjCredits.textContent) < bet){ bjMessage.textContent='Not enough credits'; return; }
                // init
                deck = createDeck(); shuffle(deck);
                playerHands = [[deck.pop(), deck.pop()]];
                betsPerHand = [bet];
                dealerHand = [deck.pop(), deck.pop()];
                currentHand = 0;
                inRound=true; bjDeal.disabled=true; bjHit.disabled=false; bjStand.disabled=false; bjDouble.disabled=false; bjSplit.disabled = canSplit(playerHands[0]) && parseInt(bjCredits.textContent) >= bet; bjMessage.textContent='';
                bjCredits.textContent = parseInt(bjCredits.textContent) - bet;
                renderHands(true);
                // check blackjack for first hand
                const pScore = scoreHand(playerHands[0]); const dScore = scoreHand(dealerHand);
                if (pScore===21){
                    if (dScore===21) endRound('Push (both blackjack)', [betsPerHand[0]]);
                    else endRound('Blackjack! You win 1.5x', [Math.floor(betsPerHand[0]*2.5)]);
                }
            });

            bjHit.addEventListener('click', ()=>{
                if (!inRound) return;
                playerHands[currentHand].push(deck.pop()); renderHands(true);
                const s = scoreHand(playerHands[currentHand]);
                if (s>21){
                    // move to next hand or finish
                    if (currentHand < playerHands.length-1){ currentHand++; renderHands(true); }
                    else { // dealer plays then resolve
                        // dealer plays
                        renderHands(false);
                        while(scoreHand(dealerHand) < 17){ dealerHand.push(deck.pop()); }
                        renderHands(false);
                        // determine payouts per hand
                        const payouts = [];
                        playerHands.forEach((hand,idx)=>{
                            const bet = betsPerHand[idx]; const p = scoreHand(hand); const d = scoreHand(dealerHand);
                            if (p>21) payouts.push(0);
                            else if (p===21 && hand.length===2) payouts.push(Math.floor(bet*2.5));
                            else if (d>21 || p> d) payouts.push(bet*2);
                            else if (p===d) payouts.push(bet);
                            else payouts.push(0);
                        });
                        endRound('Round over', payouts);
                    }
                }
            });

            bjDouble.addEventListener('click', ()=>{
                if (!inRound) return;
                const bet = betsPerHand[currentHand] || Math.max(1, Math.floor(Number(bjBet.value)||1));
                if (parseInt(bjCredits.textContent) < bet){ bjMessage.textContent='Not enough credits to double'; return; }
                // deduct extra bet
                bjCredits.textContent = parseInt(bjCredits.textContent) - bet;
                betsPerHand[currentHand] = bet*2;
                // deal one card and stand this hand
                playerHands[currentHand].push(deck.pop()); renderHands(true);
                const s = scoreHand(playerHands[currentHand]);
                // move to next hand or dealer plays
                if (currentHand < playerHands.length-1){ currentHand++; renderHands(true); }
                else {
                    // dealer plays
                    renderHands(false);
                    while(scoreHand(dealerHand) < 17){ dealerHand.push(deck.pop()); }
                    renderHands(false);
                    const payouts = [];
                    playerHands.forEach((hand,idx)=>{
                        const origBet = betsPerHand[idx]/2 || betsPerHand[idx];
                        const betVal = betsPerHand[idx];
                        const p = scoreHand(hand); const d = scoreHand(dealerHand);
                        if (p>21) payouts.push(0);
                        else if (p===21 && hand.length===2) payouts.push(Math.floor(origBet*2.5));
                        else if (d>21 || p> d) payouts.push(betVal);
                        else if (p===d) payouts.push(origBet);
                        else payouts.push(0);
                    });
                    endRound('Round over', payouts);
                }
            });

            bjSplit.addEventListener('click', ()=>{
                if (!inRound) return;
                const hand = playerHands[0];
                if (!canSplit(hand)){ bjMessage.textContent='Cannot split'; return; }
                const bet = betsPerHand[0];
                if (parseInt(bjCredits.textContent) < bet){ bjMessage.textContent='Not enough credits to split'; return; }
                // perform split: two hands with one card each, then deal one card to each
                const c1 = hand[0], c2 = hand[1];
                playerHands = [[c1, deck.pop()], [c2, deck.pop()]];
                betsPerHand = [bet, bet];
                bjCredits.textContent = parseInt(bjCredits.textContent) - bet; // deduct second bet
                currentHand = 0; bjSplit.disabled=true; renderHands(true);
            });

            bjStand.addEventListener('click', ()=>{
                if (!inRound) return;
                if (currentHand < playerHands.length-1){ currentHand++; renderHands(true); }
                else {
                    // dealer plays
                    renderHands(false);
                    while(scoreHand(dealerHand) < 17){ dealerHand.push(deck.pop()); }
                    renderHands(false);
                    const payouts = [];
                    playerHands.forEach((hand,idx)=>{
                        const bet = betsPerHand[idx]; const p = scoreHand(hand); const d = scoreHand(dealerHand);
                        if (p>21) payouts.push(0);
                        else if (p===21 && hand.length===2) payouts.push(Math.floor(bet*2.5));
                        else if (d>21 || p> d) payouts.push(bet*2);
                        else if (p===d) payouts.push(bet);
                        else payouts.push(0);
                    });
                    endRound('Round over', payouts);
                }
            });

            // new page load: ensure buttons correct
            resetDisplay();
        })();
    })();
    </script>
</body>
</html>